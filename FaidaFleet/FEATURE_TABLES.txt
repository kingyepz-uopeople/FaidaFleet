================================================================================
                    FAIDAFLEET DATABASE TABLES SUMMARY
================================================================================

FEATURE 1: VEHICLES MANAGEMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TABLE: vehicles
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant reference
  â€¢ registration_number (TEXT) - Vehicle license plate
  â€¢ make, model, year (TEXT, INTEGER) - Vehicle details
  â€¢ capacity (INTEGER) - Passenger/cargo capacity
  â€¢ vehicle_type (TEXT) - PSV, Cargo, Pickup, Other
  â€¢ insurance_expiry (DATE) - Compliance date âœ“ NEW
  â€¢ mot_expiry (DATE) - Compliance date âœ“ NEW
  â€¢ is_active (BOOLEAN) - Soft delete flag
  â€¢ created_at, updated_at (TIMESTAMPTZ) - Audit

STATUS: âœ… READY - Already in database, columns added via migration 004


FEATURE 2: FINANCIAL ANALYTICS & REPORTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TABLE 1: collections (Revenue)
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ vehicle_id (UUID) - Which vehicle collected
  â€¢ driver_id (UUID) - Which driver
  â€¢ date (DATE) - Collection date
  â€¢ shift (TEXT) - morning/afternoon/evening/night
  â€¢ amount (NUMERIC) - Revenue amount
  â€¢ payment_method (TEXT) - cash/mpesa/pochi
  â€¢ mpesa_receipt (TEXT) - Transaction reference
  â€¢ reconciled (BOOLEAN) - Verified status
  â€¢ notes (TEXT) - Optional notes

STATUS: âœ… READY - Already in database

TABLE 2: expenses (Costs)
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ vehicle_id (UUID) - Associated vehicle
  â€¢ date (DATE) - Expense date
  â€¢ category (TEXT) - fuel/maintenance/insurance/license/parking/other
  â€¢ amount (NUMERIC) - Cost amount
  â€¢ description (TEXT) - What was purchased
  â€¢ receipt_url (TEXT) - Proof of expense

STATUS: âœ… READY - Already in database

VIEW: kpi_daily (Materialized View)
PURPOSE: Auto-calculate daily P&L metrics
CALCULATES:
  â€¢ total_collections (SUM of all collections)
  â€¢ total_expenses (SUM of all expenses)
  â€¢ net_profit (collections - expenses)
  â€¢ reconciled_count (verified transactions)

STATUS: âœ… READY - Already in database


FEATURE 3: TRIPS & ROUTE TRACKING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TABLE: trips
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ vehicle_id (UUID) - Which vehicle
  â€¢ driver_id (UUID) - Which driver
  â€¢ trip_date (DATE) - Date of trip
  â€¢ start_time, end_time (TIME) - Trip duration
  â€¢ start_location, end_location (TEXT) - Route details
  â€¢ distance_km (NUMERIC) - Distance traveled
  â€¢ fuel_consumed (NUMERIC) - Fuel used
  â€¢ earnings (NUMERIC) - Trip revenue
  â€¢ expenses (NUMERIC) - Trip costs
  â€¢ status (TEXT) - planned/in_progress/completed/cancelled
  â€¢ notes (TEXT) - Optional notes

STATUS: âœ… READY - Created in migration 004_add_trips_table.sql


FEATURE 4: MAINTENANCE SCHEDULER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TABLE: maintenance_logs
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ vehicle_id (UUID) - Which vehicle
  â€¢ date (DATE) - Service date
  â€¢ type (TEXT) - service/repair/inspection/other
  â€¢ description (TEXT) - What was done
  â€¢ cost (NUMERIC) - Amount spent
  â€¢ odometer_reading (INTEGER) - Vehicle mileage
  â€¢ next_service_date (DATE) - When to service again
  â€¢ garage_name (TEXT) - Service provider

STATUS: âœ… READY - Already in database


FEATURE 5: DRIVER PERFORMANCE & ANALYTICS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TABLE 1: drivers
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ user_id (UUID) - Link to auth user
  â€¢ full_name (TEXT) - Driver name
  â€¢ phone (TEXT) - Contact number
  â€¢ license_number (TEXT) - Driver license
  â€¢ license_expiry (DATE) - License validity
  â€¢ id_number (TEXT) - National ID
  â€¢ is_active (BOOLEAN) - Active status

STATUS: âœ… READY - Already in database

TABLE 2: driver_assignments
COLUMNS:
  â€¢ id (UUID) - Primary key
  â€¢ tenant_id (UUID) - Multi-tenant
  â€¢ driver_id (UUID) - Which driver
  â€¢ vehicle_id (UUID) - Which vehicle
  â€¢ start_date (DATE) - Assignment start
  â€¢ end_date (DATE) - Assignment end
  â€¢ is_current (BOOLEAN) - Current assignment
  â€¢ notes (TEXT) - Assignment notes

PURPOSE: Track driver-vehicle assignments over time
STATUS: âœ… READY - Already in database


================================================================================
                            DATABASE QUERIES USED
================================================================================

FEATURE 1: VEHICLES
  SELECT * FROM vehicles WHERE tenant_id = ? AND is_active = true
  UPDATE vehicles SET insurance_expiry = ?, mot_expiry = ? WHERE id = ?

FEATURE 2: ANALYTICS
  SELECT * FROM kpi_daily WHERE tenant_id = ? AND date >= ?
  SELECT SUM(amount) FROM collections WHERE tenant_id = ? AND date >= ?
  SELECT SUM(amount) FROM expenses WHERE tenant_id = ? AND date >= ?

FEATURE 3: TRIPS
  SELECT * FROM trips WHERE tenant_id = ? ORDER BY trip_date DESC
  INSERT INTO trips (...) VALUES (...)
  SELECT SUM(earnings) - SUM(expenses) FROM trips WHERE tenant_id = ?

FEATURE 4: MAINTENANCE
  SELECT * FROM maintenance_logs WHERE tenant_id = ? ORDER BY date DESC
  SELECT * FROM maintenance_logs WHERE vehicle_id = ? AND next_service_date > NOW()

FEATURE 5: DRIVER STATS
  SELECT drivers.*, 
         COALESCE(SUM(collections.amount), 0) as total_earnings,
         COALESCE(SUM(expenses.amount), 0) as total_expenses,
         COUNT(trips.id) as trip_count
  FROM drivers
  LEFT JOIN collections ON collections.driver_id = drivers.id
  LEFT JOIN expenses ON expenses.driver_id = drivers.id
  LEFT JOIN trips ON trips.driver_id = drivers.id
  WHERE drivers.tenant_id = ?
  GROUP BY drivers.id
  ORDER BY total_earnings DESC

================================================================================
                                MIGRATION STATUS
================================================================================

âœ… Migration 001_initial_schema.sql
   - vehicles, drivers, collections, expenses, maintenance_logs
   - tenants, profiles, memberships

âœ… Migration 002_fix_onboarding.sql
   - Onboarding improvements

âœ… Migration 003_admin_tables.sql
   - Admin features

âœ… Migration 004_add_trips_table.sql (NEW)
   - trips table
   - vehicle columns: insurance_expiry, mot_expiry, vehicle_type
   - Indexes for performance
   - Triggers for updated_at

================================================================================
                                ALL SYSTEMS GO! ðŸš€
================================================================================
